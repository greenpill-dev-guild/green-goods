{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Green Goods Claude Code hooks v3.0 - 4 categories",

  "hooks": {
    "PreToolUse": [
      {
        "_category": "Quality",
        "_description": "Block hooks in wrong location",
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$TOOL_INPUT\" | grep -qE 'packages/(client|admin)/src/hooks/'; then echo 'üö´ BLOCKED: All hooks must be in packages/shared/src/hooks/ - see CLAUDE.md' >&2; exit 2; fi",
            "statusMessage": "Checking hook location..."
          }
        ]
      },
      {
        "_category": "Quality",
        "_description": "Block package-level .env files",
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$TOOL_INPUT\" | grep -qE 'packages/[^/]+/\\.env'; then echo 'üö´ BLOCKED: Package-level .env files not allowed. Use root .env only.' >&2; exit 2; fi",
            "statusMessage": "Checking env file location..."
          }
        ]
      },
      {
        "_category": "Quality",
        "_description": "Warn on schema file edits",
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$TOOL_INPUT\" | grep -q 'packages/contracts/config/schemas.json'; then echo '‚ö†Ô∏è WARNING: schemas.json is read-only. Use --update-schemas via deploy.ts or create schemas.test.json'; fi",
            "statusMessage": "Checking schema file..."
          }
        ]
      },
      {
        "_category": "Safety",
        "_description": "Production deployment confirmation",
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$TOOL_INPUT\" | grep -qiE 'deploy.*mainnet|upgrade.*mainnet|vercel.*--prod'; then echo 'üö® PRODUCTION DEPLOYMENT - Requires explicit user confirmation before proceeding'; fi",
            "statusMessage": "Checking deployment target..."
          }
        ]
      },
      {
        "_category": "Safety",
        "_description": "Block force push to main",
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$TOOL_INPUT\" | grep -qE 'git.*push.*--force.*(main|master)'; then echo 'üö´ BLOCKED: Never force push to main/master' >&2; exit 2; fi",
            "statusMessage": "Checking git push..."
          }
        ]
      },
      {
        "_category": "Workflow",
        "_description": "Pre-commit validation reminder",
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$TOOL_INPUT\" | grep -qE 'git commit'; then echo 'üìã PRE-COMMIT: Ensure `bun format && bun lint && bun test` passed'; fi",
            "statusMessage": "Pre-commit reminder..."
          }
        ]
      }
    ],

    "PostToolUse": [
      {
        "_category": "Workflow",
        "_description": "i18n reminder for UI components",
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$FILE_PATH\" | grep -qE '\\.tsx$'; then echo 'üìù REMINDER: Add i18n keys to en.json, es.json, pt.json for any new UI strings'; fi",
            "statusMessage": "Checking for i18n reminder..."
          }
        ]
      },
      {
        "_category": "Workflow",
        "_description": "Hardcoded address warning",
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$FILE_PATH\" | grep -qE '\\.(ts|tsx)$' && ! echo \"$FILE_PATH\" | grep -qE '(__tests__|\\.(test|spec)\\.)' && grep -q '0x[a-fA-F0-9]\\{40\\}' \"$FILE_PATH\" 2>/dev/null; then echo '‚ö†Ô∏è WARNING: Hardcoded address detected. Use deployment artifacts from packages/contracts/deployments/'; fi || true",
            "statusMessage": "Checking for hardcoded addresses..."
          }
        ]
      },
      {
        "_category": "Workflow",
        "_description": "TDD reminder for implementation files",
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$FILE_PATH\" | grep -qE 'packages/(shared|client|admin)/src/[^_].*\\.(ts|tsx)$' && ! echo \"$FILE_PATH\" | grep -q '__tests__'; then echo 'üß™ TDD: Consider writing test at __tests__/ first'; fi",
            "statusMessage": "TDD check..."
          }
        ]
      },
      {
        "_category": "Workflow",
        "_description": "Contract ABI rebuild reminder",
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$FILE_PATH\" | grep -qE 'packages/contracts/src/.*\\.sol$'; then echo 'üî® CONTRACT CHANGED: Run `bun --filter contracts build` to update ABIs'; fi",
            "statusMessage": "Contract ABI check..."
          }
        ]
      }
    ],

    "SessionStart": [
      {
        "_category": "Lifecycle",
        "_description": "Session welcome message",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'üåø Green Goods | 4 Entry Points: PRD ‚Üí Feature ‚Üí Bug ‚Üí Polish | Use TodoWrite for tracking'",
            "once": true
          }
        ]
      },
      {
        "_category": "Context",
        "_description": "Auto-remind to load package context",
        "hooks": [
          {
            "type": "command",
            "command": "PKG=$(pwd | grep -oE 'packages/[^/]+' | head -1 | cut -d/ -f2); if [ -n \"$PKG\" ] && [ -f \".claude/context/$PKG.md\" ]; then echo \"üìÅ CONTEXT: Working in packages/$PKG ‚Äî Read .claude/context/$PKG.md for package-specific patterns\"; fi",
            "once": true
          }
        ]
      }
    ],

    "SubagentStart": [
      {
        "_category": "Lifecycle",
        "_description": "cracked-coder protocol reminder",
        "matcher": "cracked-coder",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'üîß cracked-coder: TDD mandatory for features. GATHER ‚Üí PLAN ‚Üí TEST ‚Üí IMPLEMENT ‚Üí VERIFY ‚Üí DEPLOY'",
            "statusMessage": "Initializing cracked-coder..."
          }
        ]
      },
      {
        "_category": "Lifecycle",
        "_description": "code-reviewer protocol reminder",
        "matcher": "code-reviewer",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'üîç code-reviewer: Follow 6-pass protocol, post findings to GitHub.'",
            "statusMessage": "Initializing code-reviewer..."
          }
        ]
      },
      {
        "_category": "Lifecycle",
        "_description": "oracle protocol reminder",
        "matcher": "oracle",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'üîÆ oracle: Use 3+ research paths, provide evidence-based findings.'",
            "statusMessage": "Initializing oracle..."
          }
        ]
      }
    ],

    "SubagentStop": [
      {
        "_category": "Lifecycle",
        "_description": "Verify TodoWrite usage",
        "hooks": [
          {
            "type": "command",
            "command": "if ! echo \"$ARGUMENTS\" | grep -qi 'todowrite\\|todo.*completed\\|todo.*in_progress'; then echo '‚ö†Ô∏è WARN: Agent did not use TodoWrite for progress tracking'; fi",
            "statusMessage": "Checking agent TodoWrite usage..."
          }
        ]
      }
    ]
  }
}
