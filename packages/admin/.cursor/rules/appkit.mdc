---
description: Reown AppKit integration patterns for Green Goods admin dashboard
globs:
  - "packages/shared/src/providers/AppKitProvider.tsx"
  - "packages/admin/src/main.tsx"
alwaysApply: false
---

# Reown AppKit Integration (Admin)

The admin dashboard uses **Reown AppKit** for wallet connections via the shared `AppKitProvider`.

## Overview

**Reown AppKit** provides:
- One-click wallet auth (MetaMask, WalletConnect, etc.)
- Multi-chain support (EVM chains)
- Integration with Wagmi hooks

**Admin uses wallet mode only** (no passkey auth like client).

## Provider Setup

AppKit is configured in `@green-goods/shared` and used in admin's `main.tsx`:

```typescript
// packages/admin/src/main.tsx
import { AppKitProvider, WalletAuthProvider, AppProvider } from '@green-goods/shared';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <AppProvider>
      <AppKitProvider>
        <WalletAuthProvider>
          <QueryClientProvider client={queryClient}>
            <RouterProvider router={router} />
          </QueryClientProvider>
        </WalletAuthProvider>
      </AppKitProvider>
    </AppProvider>
  </React.StrictMode>
);
```

## Environment Variables

Uses root `.env` (not package-specific):

```bash
# WalletConnect Project ID (required)
VITE_WALLETCONNECT_PROJECT_ID=your-project-id

# Chain configuration
VITE_CHAIN_ID=84532  # Base Sepolia
```

Get your project ID from: https://cloud.walletconnect.com

## Using Wallet Connection

### Connect Button

Use the `<appkit-button>` web component:

```tsx
// In any component
export function ConnectButton() {
  return <appkit-button />;
}
```

Or use the custom `ConnectButton` component from admin:

```tsx
import { ConnectButton } from '@/components/ConnectButton';

function Header() {
  return (
    <header>
      <ConnectButton />
    </header>
  );
}
```

### Reading Wallet State

```typescript
import { useAccount, useChainId } from 'wagmi';

function WalletStatus() {
  const { address, isConnected } = useAccount();
  const chainId = useChainId();
  
  if (!isConnected) {
    return <p>Not connected</p>;
  }
  
  return <p>Connected: {address}</p>;
}
```

### Writing Contracts

```typescript
import { useWriteContract, useWaitForTransactionReceipt } from 'wagmi';
import { useToastAction } from '@green-goods/shared';

function CreateGarden() {
  const { writeContractAsync } = useWriteContract();
  const { executeWithToast } = useToastAction();
  
  const handleCreate = async () => {
    await executeWithToast(
      () => writeContractAsync({
        address: gardenTokenAddress,
        abi: GardenTokenABI,
        functionName: 'mintGarden',
        args: [params],
      }),
      {
        loadingMessage: 'Creating garden...',
        successMessage: 'Garden created!',
        errorMessage: 'Failed to create garden',
      }
    );
  };
  
  return <button onClick={handleCreate}>Create Garden</button>;
}
```

## Chain Configuration

Admin uses a **single chain** derived from environment:

```typescript
import { DEFAULT_CHAIN_ID, getDefaultChain } from '@green-goods/shared';

// Always use env chain, not wallet chain
const chainId = DEFAULT_CHAIN_ID;
```

**Important:** Never read chain from wallet. The app is single-chain per deployment.

## TypeScript Declaration

For `<appkit-button>` type support, ensure this exists:

```typescript
// src/vite-env.d.ts or global.d.ts
declare global {
  namespace JSX {
    interface IntrinsicElements {
      'appkit-button': React.DetailedHTMLProps<
        React.HTMLAttributes<HTMLElement>,
        HTMLElement
      >;
    }
  }
}
```

## Reference Files

- AppKitProvider: `packages/shared/src/providers/AppKitProvider.tsx`
- WalletAuthProvider: `packages/shared/src/providers/WalletAuth.tsx`
- Admin main: `packages/admin/src/main.tsx`
- ConnectButton: `packages/admin/src/components/ConnectButton.tsx`
