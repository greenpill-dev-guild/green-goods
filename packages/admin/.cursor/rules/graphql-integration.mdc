---
description: GraphQL patterns â€” Urql subscriptions, query optimization, error handling
globs:
  - utils/urql.ts
alwaysApply: false
---

# GraphQL Integration Patterns

Admin uses Urql for GraphQL with real-time subscriptions. This rule covers query patterns, subscription setup, and error handling.

## Subscription Pattern

```typescript
import { useSubscription } from 'urql';

const GARDEN_EVENTS_SUB = graphql(`
  subscription GardenEvents($chainId: Int!) {
    Garden_stream(
      where: {chainId: {_eq: $chainId}},
      cursor: {initial_value: {id: ""}},
      batch_size: 10
    ) {
      id
      name
      operators
      gardeners
    }
  }
`);

useSubscription(
  { query: GARDEN_EVENTS_SUB, variables: { chainId } },
  (_, response) => {
    if (response.Garden_stream) {
      // Handle new data
      queryClient.setQueryData(['gardens'], (old) => {
        return [...old, ...response.Garden_stream];
      });
    }
  }
);
```

## Reference Files

- Urql client: `src/utils/urql.ts`
