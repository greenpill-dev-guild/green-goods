---
description: Client (PWA) — overview, architecture, and key patterns
globs:
  - "packages/client/src/**/*"
alwaysApply: false
---

# Client Package

Offline-first PWA for gardeners and operators.

## Architecture

```
src/
├── components/      # UI components (cards, forms, dialogs)
├── views/           # Route views (lazy-loaded)
├── routes/          # Route guards (RequireAuth, AppShell)
├── styles/          # CSS (colors, typography, animation)
└── config.ts        # Client configuration
```

**Shared code lives in `@green-goods/shared`** — all hooks, providers, stores, and modules.

## Stack

| Concern | Tool |
|---------|------|
| Framework | React 18 + Vite + TypeScript |
| Styling | Tailwind CSS v4 + CSS variables |
| UI Primitives | Radix UI |
| Forms | React Hook Form + Zod |
| State | TanStack Query + Zustand (via shared) |
| Offline | IndexedDB + Service Worker |

## Critical Patterns

### All Hooks from Shared

```typescript
// ✅ Correct
import { useAuth, useWorks, useOffline } from "@green-goods/shared";

// ❌ Wrong — no local hooks
import { useLocalHook } from "./hooks/useLocalHook";
```

### Chain from Environment Only

```typescript
// ✅ Always use environment chain
import { DEFAULT_CHAIN_ID } from "@green-goods/shared";

// ❌ Never use wallet chain
const { chainId } = useAccount();
```

### Offline-First Work Submission

```typescript
import { jobQueue, jobQueueEventBus } from "@green-goods/shared";

// Add job to queue
const jobId = await jobQueue.addJob("work", payload, { chainId });

// Listen for completion
jobQueueEventBus.on("job:completed", handleComplete);
```

### Semantic Design Tokens

```typescript
// ✅ Correct
<div className="bg-bg-white text-text-strong border-stroke-soft">

// ❌ Wrong
<div className="bg-white text-gray-900">
```

## Routing

Lazy-load all views and wrap authenticated routes:

```typescript
<Route element={<RequireAuth />}>
  <Route element={<AppShell />}>
    <Route path="home" lazy={() => import("@/views/Home")} />
    <Route path="garden" lazy={() => import("@/views/Garden")} />
  </Route>
</Route>
```

## Deep Dive Rules

| Topic | Rule File |
|-------|-----------|
| Authentication | `.cursor/rules/authentication.mdc` |
| Offline Queue | `.cursor/rules/offline-architecture.mdc` |
| Card Components | `.cursor/rules/component-cards.mdc` |
| Form Components | `.cursor/rules/component-forms.mdc` |
| Modal/Drawer | `.cursor/rules/component-modals.mdc` |
| Radix UI | `.cursor/rules/component-radix.mdc` |
| Testing | `.cursor/rules/testing.mdc` |

## Shared Package Rules

| Topic | Location |
|-------|----------|
| Design System | `shared/.cursor/rules/design-system.mdc` |
| Hook Architecture | `shared/.cursor/rules/hook-architecture.mdc` |
| State Patterns | `shared/.cursor/rules/state-patterns.mdc` |
| Testing | `shared/.cursor/rules/testing-patterns.mdc` |
| AppKit | `shared/.cursor/rules/appkit-integration.mdc` |
| Imports | `shared/.cursor/rules/cross-package-imports.mdc` |

## Reference

- **AGENTS.md:** `/packages/client/AGENTS.md`
- **Shared:** `/packages/shared/AGENTS.md`
