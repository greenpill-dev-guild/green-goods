---
description: Form component patterns — inputs, validation, React Hook Form integration
globs:
  - "**/Form/**/*.tsx"
  - "**/Inputs/**/*.tsx"
alwaysApply: false
---

# Form Components

Form patterns using React Hook Form with Zod validation.

## FormInput

Standard text input with label and error:

```typescript
interface FormInputProps extends InputHTMLAttributes<HTMLInputElement> {
  label: string;
  helperText?: string;
  error?: string;
}

<FormInput
  label="Title"
  {...register("title")}
  error={errors.title?.message}
  helperText="Enter a descriptive title"
/>
```

**Styling:**

```typescript
<input
  className={cn(
    "w-full px-4 py-3 rounded-lg",
    "border border-stroke-soft bg-bg-white",
    "text-text-strong placeholder:text-text-soft",
    "focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",
    error && "border-error-base"
  )}
/>
```

## FormTextarea

Multi-line text input:

```typescript
<FormTextarea
  rows={4}
  label="Description"
  {...register("description")}
  error={errors.description?.message}
/>
```

## FormSelect

Multi-select dropdown:

```typescript
<FormSelect
  name="plantTypes"
  label="Plant Types"
  control={control}
  options={[
    { label: "Trees", value: "trees" },
    { label: "Flowers", value: "flowers" },
  ]}
  isMulti={true}
/>
```

## Date Input

```typescript
import { toDateTimeLocalValue, fromDateTimeLocalValue } from "@green-goods/shared";

<input
  type="datetime-local"
  value={toDateTimeLocalValue(startTime.getTime())}
  onChange={(e) => setStartTime(fromDateTimeLocalValue(e.target.value))}
  className="w-full rounded-md border border-stroke-soft px-3 py-2"
/>
```

## React Hook Form Integration

```typescript
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { workDraftSchema } from "@green-goods/shared";

const form = useForm<WorkDraft>({
  resolver: zodResolver(workDraftSchema),
  defaultValues: {
    title: "",
    description: "",
  },
});

const onSubmit = form.handleSubmit((data) => {
  // Submit data
});
```

## Validation Patterns

### Zod Schemas

```typescript
import { z } from "zod";

export const workDraftSchema = z.object({
  title: z.string().min(1, "Title is required"),
  description: z.string().min(10, "At least 10 characters"),
  media: z.array(z.instanceof(File)).min(1, "At least one photo"),
});
```

### Field-Level Validation

```typescript
<FormInput
  {...register("feedback", {
    required: "Feedback is required",
    minLength: { value: 10, message: "At least 10 characters" },
  })}
  error={errors.feedback?.message}
/>
```

## Form Layout

```typescript
import { FormLayout } from "@green-goods/shared";

<FormLayout>
  <FormInput label="Title" {...register("title")} />
  <FormTextarea label="Description" {...register("description")} />
  <Button type="submit" label="Submit" disabled={!formState.isValid} />
</FormLayout>
```

## Image Upload

```typescript
const handleImageSelect = async (files: FileList) => {
  const compressed = await Promise.all(
    Array.from(files).map((f) => imageCompressor.compress(f))
  );
  setImages((prev) => [...prev, ...compressed]);
};

<input
  type="file"
  accept="image/*"
  multiple
  onChange={(e) => handleImageSelect(e.target.files)}
  className="hidden"
  ref={fileInputRef}
/>
```

## Error Display

```typescript
{error && (
  <p className="text-xs text-error-base mt-1">
    {error}
  </p>
)}

{helperText && !error && (
  <p className="text-xs text-text-soft mt-1">
    {helperText}
  </p>
)}
```

## Accessibility (WCAG 2.1 AA)

**All forms MUST be fully accessible.** Follow these patterns:

### Label Association (MANDATORY)

```typescript
// ✅ Correct — proper label association
<div className="space-y-1">
  <label htmlFor={inputId} className="font-semibold text-text-strong">
    {label}
    {required && <span className="text-error-base ml-1" aria-hidden="true">*</span>}
    {required && <span className="sr-only">(required)</span>}
  </label>
  <input
    id={inputId}
    aria-describedby={cn(
      helperText && `${inputId}-helper`,
      error && `${inputId}-error`
    )}
    aria-invalid={!!error}
    aria-required={required}
  />
  {helperText && !error && (
    <p id={`${inputId}-helper`} className="text-xs text-text-soft">
      {helperText}
    </p>
  )}
  {error && (
    <p id={`${inputId}-error`} role="alert" className="text-xs text-error-base">
      {error}
    </p>
  )}
</div>

// ❌ Wrong — no label association
<span>Title</span>
<input type="text" />
```

### Keyboard Navigation

```typescript
// Form should be navigable with Tab key
// Submit on Enter (default for single-line inputs)
// Support Escape to cancel/close

<form onKeyDown={(e) => {
  if (e.key === "Escape") {
    onCancel();
  }
}}>
  {/* Form fields */}
</form>
```

### Error Announcements

```typescript
// Errors should be announced to screen readers
// Use role="alert" or aria-live="polite"

{error && (
  <p
    id={`${inputId}-error`}
    role="alert"
    aria-live="polite"
    className="text-xs text-error-base mt-1"
  >
    <RiErrorWarningLine className="inline h-4 w-4 mr-1" aria-hidden="true" />
    {error}
  </p>
)}

// For form-level errors (announced on submit)
{submitError && (
  <div role="alert" className="bg-error-lighter p-4 rounded-lg">
    <h3 className="text-error-dark font-semibold">Please fix the following:</h3>
    <ul>
      {Object.values(errors).map((err) => (
        <li key={err}>{err}</li>
      ))}
    </ul>
  </div>
)}
```

### Focus Management

```typescript
// Focus first error on submit failure
const onSubmit = async (data) => {
  try {
    await submit(data);
  } catch (error) {
    // Focus first invalid field
    const firstError = document.querySelector('[aria-invalid="true"]');
    firstError?.focus();
  }
};

// Focus first field on modal open
useEffect(() => {
  if (isOpen) {
    const firstInput = formRef.current?.querySelector('input, textarea, select');
    firstInput?.focus();
  }
}, [isOpen]);
```

### Touch Targets

```typescript
// Input height minimum 44px for touch
<input
  className="min-h-[44px] px-4 py-3 ..."
/>

// Checkbox/radio minimum 44x44px hit area
<label className="flex items-center min-h-[44px] cursor-pointer">
  <input type="checkbox" className="h-5 w-5 mr-3" />
  <span>Remember me</span>
</label>
```

### Fieldset for Groups

```typescript
// Group related fields with fieldset/legend
<fieldset>
  <legend className="text-label-md text-text-strong mb-2">
    Contact Information
  </legend>
  <div className="space-y-4">
    <FormInput label="Email" {...register("email")} />
    <FormInput label="Phone" {...register("phone")} />
  </div>
</fieldset>

// Radio groups
<fieldset>
  <legend className="sr-only">Select payment method</legend>
  <div role="radiogroup" className="space-y-2">
    <label className="flex items-center">
      <input type="radio" name="payment" value="card" />
      <span className="ml-2">Credit Card</span>
    </label>
    {/* More options */}
  </div>
</fieldset>
```

### Autocomplete Attributes

```typescript
// Help browsers/password managers autofill
<input
  type="email"
  autoComplete="email"
  {...register("email")}
/>

<input
  type="text"
  autoComplete="name"
  {...register("fullName")}
/>

<input
  type="text"
  autoComplete="street-address"
  {...register("address")}
/>
```

### Form Accessibility Checklist

- [ ] Every input has an associated `<label>` with `htmlFor`
- [ ] Required fields marked with `aria-required="true"`
- [ ] Error messages linked via `aria-describedby`
- [ ] Invalid fields have `aria-invalid="true"`
- [ ] Errors announced with `role="alert"`
- [ ] Focus moves to first error on validation failure
- [ ] Touch targets are at least 44x44px
- [ ] Form can be submitted with Enter key
- [ ] Autocomplete attributes set for common fields

## Anti-Patterns

```typescript
// ❌ Wrong — uncontrolled with manual state
const [value, setValue] = useState("");
<input value={value} onChange={(e) => setValue(e.target.value)} />

// ✅ Correct — React Hook Form
const { register } = useForm();
<input {...register("fieldName")} />
```

## Reference Files

- Input: `src/components/Inputs/Input.tsx`
- Textarea: `src/components/Inputs/Textarea.tsx`
- Select: `src/components/Inputs/FormSelect.tsx`
- Validation: `@green-goods/shared` schemas
