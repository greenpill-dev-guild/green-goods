---
description: Shared package — common code for client and admin apps
globs:
  - "packages/shared/src/**/*"
alwaysApply: false
---

# Shared Package

Central code repository consumed by client and admin apps.

## What Lives Here

| Category | Location | Purpose |
|----------|----------|---------|
| **Hooks** | `src/hooks/` | All custom React hooks |
| **Providers** | `src/providers/` | Auth, JobQueue, Work, App |
| **Stores** | `src/stores/` | Zustand state management |
| **Modules** | `src/modules/` | Core business logic |
| **Workflows** | `src/workflows/` | XState machines |
| **Utils** | `src/utils/` | Utility functions |
| **Types** | `src/types/` | TypeScript definitions |
| **Config** | `src/config/` | App, chains, pimlico |
| **i18n** | `src/i18n/` | Translations (en, es, pt) |
| **Components** | `src/components/` | Toast, Spinner, StatusBadge |

## Critical Patterns

### Explicit Exports Only

```typescript
// ✅ Correct
export { useAuth } from "./auth/useAuth";
export type { Garden } from "./types";

// ❌ Wrong — no wildcard exports
export * from "./auth";
```

### Import from Package Root

```typescript
// ✅ From client/admin
import { useAuth, useWorks } from '@green-goods/shared';
import type { Garden, Work } from '@green-goods/shared';

// ❌ Wrong — deep imports
import { useAuth } from '@green-goods/shared/src/hooks/auth/useAuth';
```

### Chain from Environment Only

```typescript
// ✅ Correct
import { DEFAULT_CHAIN_ID, useCurrentChain } from '@green-goods/shared';

// ❌ Wrong — never use wallet chain
const { chainId } = useAccount();
```

### Event-Driven Updates

```typescript
// ✅ Correct — react to events
useJobQueueEvents(['job:completed'], () => {
  queryClient.invalidateQueries({ queryKey: queryKeys.works.merged(gardenId, chainId) });
});

// ❌ Wrong — no polling
setInterval(() => refetch(), 5000);
```

### Centralized Query Keys

```typescript
import { queryKeys, queryInvalidation } from '@green-goods/shared';

// ✅ Correct — use centralized keys
queryClient.invalidateQueries({ queryKey: queryKeys.works.merged(gardenId, chainId) });

// ❌ Wrong — ad-hoc keys
queryClient.invalidateQueries({ queryKey: ['works', gardenId] });
```

## Provider Hierarchy

Required nesting order:

```tsx
<WagmiProvider>
  <AppKitProvider>
    <AuthProvider>
      <AppProvider>
        <QueryClientProvider>
          <JobQueueProvider>
            <WorkProvider>
              {children}
            </WorkProvider>
          </JobQueueProvider>
        </QueryClientProvider>
      </AppProvider>
    </AuthProvider>
  </AppKitProvider>
</WagmiProvider>
```

## Deep Dive Rules

| Topic | Rule File |
|-------|-----------|
| Design System | `.cursor/rules/design-system.mdc` |
| Hook Architecture | `.cursor/rules/hook-architecture.mdc` |
| State Patterns | `.cursor/rules/state-patterns.mdc` |
| Testing | `.cursor/rules/testing-patterns.mdc` |
| AppKit | `.cursor/rules/appkit-integration.mdc` |
| Imports | `.cursor/rules/cross-package-imports.mdc` |

## Reference

- **AGENTS.md:** `/packages/shared/AGENTS.md`
- **Client:** `/packages/client/AGENTS.md`
- **Admin:** `/packages/admin/AGENTS.md`
