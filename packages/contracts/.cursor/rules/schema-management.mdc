---
description: EAS schema management — IMMUTABLE schemas.json, versioning
globs:
  - config/schemas.json
  - script/**
alwaysApply: false
---

# Schema Management — CRITICAL

## ⛔ NEVER MODIFY `config/schemas.json`

This file defines **production EAS schemas** deployed on-chain. Modifying it:
- Creates duplicate schemas with wrong metadata
- Breaks indexer queries
- Makes historical attestations unfindable

**For test schemas:** Create `schemas.test.json` instead.

## Schema Commands

```bash
# Deploy contracts + schemas
bun deploy:testnet

# Update schema name/description only (not fields)
bun script/deploy.ts core --network baseSepolia --broadcast --update-schemas

# Skip schemas (if already deployed)
bun script/deploy.ts core --network baseSepolia --broadcast --skip-schemas
```

## Current Schemas

| Schema | Key Fields |
|--------|------------|
| Work | `actionUID`, `title`, `feedback`, `metadata`, `media[]` |
| Work Approval | `actionUID`, `workUID`, `approved`, `feedback` |
| Assessment | `title`, `description`, `assessmentType`, `capitals[]`, `metricsJSON`, ... |

## Schema Versioning

**Don't modify fields in schemas.json.** For new fields:

1. Create new schema version in separate file
2. Deploy to get new UID
3. Update encoders to support both versions
4. Frontend decodes based on schema UID

## Anti-Patterns

```typescript
// ❌ Never hardcode UIDs
const WORK_SCHEMA_UID = '0x123...';

// ✅ Load from deployment
import deployment from '../deployments/84532-latest.json';
const WORK_SCHEMA_UID = deployment.schemas.workSchemaUID;
```

## Reference

- Schemas: `config/schemas.json` (READ ONLY)
- Deployment artifacts: `deployments/*-latest.json`
