---
description: Testing conventions — unit tests, integration tests, naming patterns, gas reporting
globs:
  - test/**
alwaysApply: false
---

# Testing Conventions

Foundry test patterns for Green Goods contracts.

## Test Naming

### Function Naming Pattern

```solidity
// Pattern: test[ContractName]_[scenario]
function testGardenToken_mintsNewGarden() public {
    // ...
}

function testGardenToken_revertsOnUnauthorizedMint() public {
    vm.prank(unauthorized);
    vm.expectRevert();
    gardenToken.mintGarden(owner, metadata);
}
```

### Test Categories

Prefix for test organization:

- `test_` — Happy path unit tests
- `testRevert_` — Failure cases with reverts
- `testFuzz_` — Fuzz tests
- `testIntegration_` — Multi-contract flows
- `testUpgrade_` — UUPS upgrade safety

## Test Structure

```solidity
contract GardenTokenTest is Test {
    GardenToken public gardenToken;
    address public owner;
    address public unauthorized;
    
    function setUp() public {
        owner = address(this);
        unauthorized = address(0x1);
        
        gardenToken = new GardenToken();
        gardenToken.initialize();
    }
    
    function testGardenToken_mintsNewGarden() public {
        // Arrange
        string memory metadata = "ipfs://Qm...";
        
        // Act
        uint256 tokenId = gardenToken.mintGarden(owner, metadata);
        
        // Assert
        assertEq(gardenToken.ownerOf(tokenId), owner);
        assertEq(gardenToken.tokenMetadata(tokenId), metadata);
    }
}
```

## Gas Reporting

```bash
# Generate gas report
forge test --gas-report

# Save to file
forge test --gas-report > gas-report.txt
```

### Gas Benchmarks

Monitor these functions:
- `mintGarden`: Target <500k gas
- `registerAction`: Target <200k gas
- `attest` (via resolver): Target <150k gas

## Coverage Target

- **Testnet:** 80% pass rate acceptable
- **Mainnet:** 100% tests must pass

## Reference Files

- Test files: `test/*.t.sol`
- Test helpers: `test/helpers/`
- Gas limits: `docs/GAS_LIMITS.md`
