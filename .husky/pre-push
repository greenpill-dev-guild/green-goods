#!/usr/bin/env sh
set -eu

# Enable pipefail only if supported (dash doesn't support it)
(set -o pipefail) 2>/dev/null && set -o pipefail

# Load nvm if available
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Use Node version from .nvmrc if nvm is available
if command -v nvm >/dev/null 2>&1; then
  nvm use 2>/dev/null || true
fi

echo "ğŸ” Running pre-push checks..."

# Determine runner (bun preferred, npm fallback)
if command -v bun >/dev/null 2>&1; then
  RUNNER="bun run"
elif command -v npm >/dev/null 2>&1; then
  RUNNER="npm run"
else
  echo "Error: Neither bun nor npm found. Install bun: https://bun.sh"
  exit 1
fi

# 1. Format check
echo "ğŸ“ Checking formatting..."
$RUNNER format:check

# 2. Lint
echo "ğŸ” Running linter..."
$RUNNER lint

echo "âœ… Pre-push checks passed!"
