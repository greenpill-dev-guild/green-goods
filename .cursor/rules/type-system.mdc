# Type System — Centralized TypeScript Types

**Status:** Active (January 2026)  
**Applies to:** All TypeScript packages (shared, client, admin, agent)

## Golden Rule

**All domain types live in `@green-goods/shared` and must be explicitly imported.**

```typescript
// ✅ Correct
import type { Garden, Work, Action } from '@green-goods/shared';

// ❌ Wrong - no global types
const garden: Garden = { ... }; // Don't rely on globals
```

## Type Categories

### Domain Types (`types/domain.ts`)

Core business entities:

```typescript
import type {
  // Core entities
  Garden,
  Work,
  Action,
  WorkApproval,
  GardenAssessment,
  
  // Card variants
  GardenCard,
  WorkCard,
  ActionCard,
  GardenerCard,
  
  // Drafts
  WorkDraft,
  WorkApprovalDraft,
  AssessmentDraft,
  
  // Supporting types
  WorkInput,
  WorkMetadata,
  PlantInfo,
  ActionInstructionConfig,
  
  // Primitives
  Address,  // viem's Address type
  Capital,  // enum
} from '@green-goods/shared';

// Capital enum values
import { Capital } from '@green-goods/shared';
```

### Job Queue Types (`types/job-queue.ts`)

Offline queue system:

```typescript
import type {
  Job,
  JobProcessor,
  WorkJobPayload,
  ApprovalJobPayload,
  QueueEvent,
  QueueStats,
  JobKind,
  JobPayload,
  QueueSubscriber,
  CachedWork,
  JobQueueDBImage,
} from '@green-goods/shared';
```

### Offline Types (`types/offline.ts`)

Offline features:

```typescript
import type {
  OfflineStatus,
  OfflineWorkItem,
  OfflineDashboardData,
  SyncMetrics,
  OfflineSettings,
  OfflineCapabilities,
  WorkConflict,
  DuplicateCheckResult,
} from '@green-goods/shared';
```

### API Response Types

#### Indexer (`types/indexer-responses.ts`)

```typescript
import type {
  IndexerGarden,
  IndexerGardensResponse,
  IndexerAction,
  IndexerActionsResponse,
  IndexerGardener,
  IndexerGardenersResponse,
} from '@green-goods/shared';
```

#### EAS (`types/eas-responses.ts`)

```typescript
import type {
  EASWork,
  EASWorkApproval,
  EASGardenAssessment,
  EASAttestationRaw,
  EASAttestationsResponse,
  EASDecodedField,
} from '@green-goods/shared';
```

## When to Create Local Types

**✅ DO create local types for:**

1. **Component Props**
```typescript
// In component file
interface WorkCardProps {
  work: Work;  // Domain type from shared
  onClick: () => void;  // Component-specific
  className?: string;  // Component-specific
}
```

2. **View Models**
```typescript
// In view file
interface WorkDashboardState {
  works: Work[];  // Domain type from shared
  activeTab: 'pending' | 'completed';  // View-specific
  filters: FilterState;  // View-specific
}
```

3. **Form Helpers**
```typescript
// In form component
interface FormFieldConfig {
  name: string;
  label: string;
  type: 'text' | 'number';
}
```

**❌ DON'T create local types for:**

1. **Domain Entities** (Garden, Work, Action, etc.)
2. **API Payloads** (WorkJobPayload, ApprovalJobPayload, etc.)
3. **Business Logic Types** (Job, QueueEvent, etc.)

## Agent Workflow

### Step 1: Check Existing Types

Before creating a new type, search shared:

```bash
# Search for existing types
grep -r "interface Garden" packages/shared/src/types/
grep -r "interface Work" packages/shared/src/types/
```

### Step 2: Import or Extend

```typescript
// Import if exists
import type { Work } from '@green-goods/shared';

// Extend if needed
import type { Work } from '@green-goods/shared';

export interface EnhancedWork extends Work {
  agentSpecificField: string;
}
```

### Step 3: Never Duplicate

```typescript
// ❌ Bad - duplicating domain type
export interface Work {
  id: string;
  title: string;
  // ...
}

// ✅ Good - importing and extending
import type { Work } from '@green-goods/shared';

export interface WorkWithMetadata extends Work {
  metadata: { ... };
}
```

## Zod Schema Pattern

Zod schemas should reference domain types as the source of truth:

```typescript
import type { WorkDraft } from '@green-goods/shared';
import { z } from 'zod';

// Schema for validation (can be stricter)
export const workDraftSchema = z.object({
  feedback: z.string().min(10),  // Stricter validation
  plantSelection: z.array(z.string()),
  plantCount: z.number().optional(),
  // ... other WorkDraft fields
});

// Inferred type should align with domain type
type WorkDraftForm = z.infer<typeof workDraftSchema>;

// Or extend domain type with validation metadata
interface WorkDraftWithValidation extends WorkDraft {
  _validated: true;
}
```

## Common Patterns

### Pattern 1: Component with Domain Type

```typescript
import type { Work } from '@green-goods/shared';

interface WorkCardProps {
  work: Work;
  onClick: () => void;
}

export const WorkCard: React.FC<WorkCardProps> = ({ work, onClick }) => {
  // Component implementation
};
```

### Pattern 2: API Response Parsing

```typescript
import type { IndexerGarden, Garden } from '@green-goods/shared';

function parseGarden(indexer: IndexerGarden): Garden {
  return {
    id: indexer.id,
    chainId: indexer.chainId,
    name: indexer.name ?? 'Unnamed',
    // ... map all fields
  };
}
```

### Pattern 3: Job Queue Processing

```typescript
import type { Job, WorkJobPayload, Work } from '@green-goods/shared';

function jobToWork(job: Job<WorkJobPayload>): Work {
  return {
    id: job.id,
    title: job.payload.title ?? 'Untitled',
    actionUID: job.payload.actionUID,
    // ... convert payload to Work
  };
}
```

### Pattern 4: Form to Domain

```typescript
import type { WorkDraft, Work } from '@green-goods/shared';
import { z } from 'zod';

// Form schema
const workFormSchema = z.object({
  feedback: z.string().min(1),
  plantSelection: z.array(z.string()),
});

// Form type
type WorkForm = z.infer<typeof workFormSchema>;

// Convert to domain type
function formToDraft(form: WorkForm): WorkDraft {
  return {
    ...form,
    actionUID: selectedAction.id,
    media: selectedFiles,
    // ... additional fields
  };
}
```

## Anti-Patterns

### ❌ Don't Rely on Global Types

```typescript
// Bad - assuming global type
const work: Work = { ... };

// Good - explicit import
import type { Work } from '@green-goods/shared';
const work: Work = { ... };
```

### ❌ Don't Duplicate Domain Types

```typescript
// Bad - duplicating in package
export interface Garden {
  id: string;
  name: string;
}

// Good - importing from shared
import type { Garden } from '@green-goods/shared';
```

### ❌ Don't Define Domain Types in Components

```typescript
// Bad - domain type in component
export interface Work {
  id: string;
  title: string;
}

export const WorkCard: React.FC<{ work: Work }> = ...

// Good - import domain type
import type { Work } from '@green-goods/shared';

export const WorkCard: React.FC<{ work: Work }> = ...
```

### ❌ Don't Use Hex for Addresses

```typescript
// Bad - too broad
import type { Hex } from 'viem';
const address: Hex = '0x...';

// Good - proper Address type
import type { Address } from '@green-goods/shared';
const address: Address = '0x...';
```

## IDE Support

### Auto-Import Configuration

VS Code should auto-suggest imports. If not, add to `.vscode/settings.json`:

```json
{
  "typescript.preferences.autoImportFileExcludePatterns": [
    "**/node_modules/@green-goods/shared/src/types/*.d.ts"
  ],
  "typescript.suggest.autoImports": true
}
```

## Reference

- **Migration Guide:** `packages/shared/TYPE_MIGRATION_GUIDE.md`
- **Implementation Summary:** `TYPE_CENTRALIZATION_SUMMARY.md`
- **Verification Report:** `TYPE_VERIFICATION_REPORT.md`
- **Type Exports:** `packages/shared/src/types/index.ts`

## Quick Reference Table

| Type | Import From | Use When |
|------|-------------|----------|
| Garden, Work, Action | `@green-goods/shared` | Core entities |
| Job, WorkJobPayload | `@green-goods/shared` | Queue operations |
| OfflineStatus | `@green-goods/shared` | Offline features |
| IndexerGarden | `@green-goods/shared` | Parsing indexer |
| EASWork | `@green-goods/shared` | Parsing EAS |
| Address | `@green-goods/shared` | Blockchain addresses |
| Capital | `@green-goods/shared` (enum) | Capital types |
| WorkCardProps | Local to component | Component props |
| FormState | Local to view | View-specific state |
